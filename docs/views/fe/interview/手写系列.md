---
title: å‰ç«¯åŸºç¡€ - æ‰‹å†™ç³»åˆ—
sidebar: 'auto'
date: 2020-12-03
tags:
 - æºç 
categories:
 - code
---

> ç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ ğŸ•µğŸ•µğŸ•µ

<!-- more -->


## å®ç° callã€applyã€bind

### call
```
function myCall(ctx = window, ...args) {
  ctx = ctx || window;
  // ä¸ºcontext åˆ›å»ºä¸€ä¸ª Symbolï¼ˆä¿è¯ä¸ä¼šé‡åï¼‰å±æ€§ï¼Œå°†å½“å‰å‡½æ•°èµ‹å€¼ç»™è¿™ä¸ªå±æ€§
  const fn = Symbol();
  ctx[fn] = this;
  // å¤„ç†å‚æ•°ï¼Œä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°åçš„å…¶ä½™å‚æ•°
  const res = ctx[fn](...args);
  // è°ƒç”¨å‡½æ•°åå³åˆ é™¤è¯¥Symbolå±æ€§
  delete ctx[fn];
  return res;
}
Function.prototype.call = function (context, ...args) {

  var context = context || window;

  context.fn = this;

  var result = eval('context.fn(...args)');

  delete context.fn

  return result;

}
```
### apply

```
function myApply(ctx = window, args) {
  ctx = ctx || window;
  const fn = Symbol();
  ctx[fn] = this;
  if (Array.isArray(args)) {
    result = ctx[fn](...args);
  } else {
    result = ctx[fn]();
  }
  delete ctx[fn];
  return res;
}
Function.prototype.apply = function (context, args) {

  let context = context || window;

  context.fn = this;

  let result = eval('context.fn(...args)');

  delete context.fn

  return result;

}
```
### bind
```
function myBind(ctx, ...args1) {
  const _this = this;
  return function F(...args2) {
    if (this instanceof F) {
      // åˆ¤æ–­æ˜¯å¦ä¸ºæ„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦‚æœæ˜¯åˆ™ä½¿ç”¨newè°ƒç”¨å½“å‰å‡½æ•°
      return new _this(...args1, ...args2)
    } else {
      // å¦‚æœä¸æ˜¯ï¼Œä½¿ç”¨applyï¼Œå°†contextå’Œå¤„ç†å¥½çš„å‚æ•°ä¼ å…¥
      return _this.apply(ctx, args1.concat(args2))
    }
  }
}
```







## å®ç° æ·±å…‹éš†
```js
function deepClone( obj ){
  if(obj === null) return null;
  if( typeof obj !== 'object' )return obj;
  if(obj instanceof RegExp) return new RegExp(obj);
  if(obj instanceof Date) return new Date(obj)

  var newObj = new obj.constructor();
  for(keys in obj){
    if( obj.hasOwnProperty(keys)){
      newObj[keys] = deepClone(obj[keys]);
    }
  }
  return newObj;
}

var aa = {
    a:1,
    b:"234",
    c:{
        e:[1,2,3,4],
        f:{
            g:34,
            h:"45",
            i:{
                j:[7,4,5,6,'323']
            }
        }
    },
    k:new Date(),
    m:/\W(1-9)/g,
    l:undefined,
    n:null
}
var bb = deepClone(aa);
console.log(aa === bb)  //false
```

## å®ç° new
```js
function _new (fn,args){
  var obj = Object.create(fn.prototype);
  var result = fn.apply(obj,args);
  return result instanceof Object ? result : obj;
}

```

## å®ç° instanceof 
```js
function myInstanceof(L,R){
  var _R_ = R.prototype;
  var _L_ = L.__proto__;
  while(true){
    if( !_L_ ) return false;
    if( _L_ == _R_ ) return true;
    _L_ = _L_.__proto__;
  }
}

console.log(myInstanceof([], Array))   //true
```

## å®ç° add(1)(2)(3) æŸ¯é‡ŒåŒ–;
```js
var curry = (fn,...args) => args.length >= fn.length ? fn(...args) : (..._args) => curry(fn,...args,..._args)
var sub = function(x,y,z){
  return x+y+z;
}
var add = curry(sub);
add(1)(2)(3)  //6
```

## å®ç° add(1,2,3,4)(5)(6,7).sub() æŸ¯é‡ŒåŒ–å‡½æ•°;
```js
function add(...args){
  var params = [...args];
  function curry (){
    params = [...params,...arguments];
    return curry;
  }
  curry.sub = function(){
    return params.reduce((p,n)=>p+n,0)
  }
  return curry;
}

add(1,2,3,4,5)(6)(7,8).sub()  //36
```

## å®ç° Object.create
```js
function myCreate(obj){
  function C(){}
  C.prototype = obj;
  return new C();
}
```
## å®ç° é˜²æŠ–ã€èŠ‚æµ

### é˜²æŠ–
ä¸€æ®µæ—¶é—´å†…åªæ‰§è¡Œæœ€åä¸€æ¬¡
```
function debounce(fn, delay=500) {
    // timer å†™åœ¨é—­åŒ…ä¸­ï¼Œå› æ­¤é˜²æŠ–ä¹Ÿæ˜¯é—­åŒ…çš„ä¸€ä¸ªåº”ç”¨
    let timer = null;

    return function() {
        if (timer) {
            clearTimeout(timer)
        }
        timer = setTimeout(() => {
            fn.apply(this, arguments);
            timer = null;
        }, delay)
    }
}

// éªŒè¯
input1.addEventListener('keyup', debounce(() => {
    console.log(input1.value);
}), 600)
```
### èŠ‚æµï¼ˆthrottleï¼‰
ä¸€æ®µæ—¶é—´å†…åªæ‰§è¡Œç¬¬ä¸€æ¬¡
```
function throttle(fn, delay = 100) {
    let timer = null

    return function() {
        if (timer) {
            return
        }
        timer = setTimeout(() => {
            fn.apply(this, arguments)
            clearTimeout(timer) 
            timer = null
        }, delay)
    }
}

div1.addEventListener(('drag', throttle(function (e) {
    console.log(e.offsetX, e.offsetY)
})))
```



## å®ç°è§‚å¯Ÿè€…æ¨¡å¼
```js
class PubSub {
  constructor() {
    this.handles = {};
  }

  // è®¢é˜…äº‹ä»¶
  on(eventType, handle) {
    if (!this.handles.hasOwnProperty(eventType)) {
      this.handles[eventType] = [];
    }
    if (typeof handle == 'function') {
      this.handles[eventType].push(handle);
    } else {
      throw new Error('ç¼ºå°‘å›è°ƒå‡½æ•°');
    }
    return this;
  }

  // å‘å¸ƒäº‹ä»¶
  emit(eventType, ...args) {
    if (this.handles.hasOwnProperty(eventType)) {
      this.handles[eventType].forEach((item, key, arr) => {
        item.apply(null, args);
      })
    } else {
      throw new Error(`"${eventType}"äº‹ä»¶æœªæ³¨å†Œ`);
    }
    return this;
  }

  // åˆ é™¤äº‹ä»¶
  off(eventType, handle) {
    if (!this.handles.hasOwnProperty(eventType)) {
      throw new Error(`"${eventType}"äº‹ä»¶æœªæ³¨å†Œ`);
    } else if (typeof handle != 'function') {
      throw new Error('ç¼ºå°‘å›è°ƒå‡½æ•°');
    } else {
      this.handles[eventType].forEach((item, key, arr) => {
        if (item == handle) {
          arr.splice(key, 1);
        }
      })
    }
    return this; // å®ç°é“¾å¼æ“ä½œ
  }
}

// ä¸‹é¢åšä¸€äº›éªšæ“ä½œ
let callback = function () {
  console.log('you are so nice');
}

let pubsub = new PubSub();
pubsub.on('completed', (...args) => {
  console.log(args.join(' '));
}).on('completed', callback);

pubsub.emit('completed', 'what', 'a', 'fucking day');
pubsub.off('completed', callback);
pubsub.emit('completed', 'fucking', 'again');
```